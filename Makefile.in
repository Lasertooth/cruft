# Makefile for cruft

CC     = @CC@
CFLAGS = @CFLAGS@ -Wall -W -ansi -pedantic-errors

INS = install

DATADIRS = filters explain

DESTDIR = `pwd`/debian/cruft

PROGS1 = canonical filter_shell merge_diff readlinks
PROGS2 = dash-search
PROGS  = $(PROGS1) $(PROGS2)

filter_shell dash-search: shellexp.o

all : $(PROGS)

merge_diff: merge_diff.o merge_diff_funcs.o

install1 : $(PROGS1) extrafiles cruft_find filter_ignores
	$(INS) $^ $(DESTDIR)/usr/lib/cruft/

install11 : common.sh common.pl
	$(INS) -m 0644 $^ $(DESTDIR)/usr/lib/cruft/

install2 : $(PROGS2)
	$(INS) $< $(DESTDIR)/usr/bin/$<

installdirs : $(DATADIRS)
	set -e ; for d in $^ ; do \
		mkdir $(DESTDIR)/usr/lib/cruft/$$d; \
		find $$d -maxdepth 1 -type f | xargs -i cp '{}' $(DESTDIR)/usr/lib/cruft/$$d/; \
	done

install : install1 install11 install2 installdirs cruft extrafiles
	$(INS) cruft $(DESTDIR)/usr/sbin/cruft
	$(INS) extrafiles $(DESTDIR)/usr/lib/cruft/filters/cruft

clean : 
	rm -f $(PROGS) merge_diff.o merge_diff_funcs.o shellexp.o *~ debian/*~ shellexptest.o shellexptest

shellexptest: shellexptest.o shellexp.o

distclean : clean
	rm -f Makefile config.cache config.status config.log

devclean : configclean
	rm -f configure

.PHONY : all clean configclean distclean install
